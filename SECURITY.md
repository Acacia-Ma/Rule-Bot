# 源码保护方案

为了保护 Rule-Bot 的源码不被窃取，我们提供了多种源码保护方案。

## 方案对比

| 方案 | 保护级别 | 镜像大小 | 构建时间 | 兼容性 | 推荐度 |
|------|----------|----------|----------|--------|--------|
| 字节码编译 | 中等 | 小 | 快 | 好 | ⭐⭐⭐ |
| PyInstaller 打包 | 高 | 中 | 中 | 好 | ⭐⭐⭐⭐⭐ |

## 方案一：字节码编译（推荐）

### 特点
- ✅ **中等保护**：源码被编译为 `.pyc` 字节码文件
- ✅ **镜像小**：只增加少量字节码文件
- ✅ **构建快**：编译过程简单快速
- ✅ **兼容性好**：与原始 Python 环境完全兼容

### 使用方法
```bash
# 使用字节码编译版本
docker build -f Dockerfile.bytecode -t rule-bot:secure .
```

### 保护效果
- 源码 `.py` 文件被删除
- 只保留编译后的 `.pyc` 字节码文件
- 字节码可以反编译，但增加了逆向难度

## 方案二：PyInstaller 打包（最高安全）

### 特点
- ✅ **最高保护**：源码被完全打包成可执行文件
- ✅ **无法反编译**：源码完全不可见
- ✅ **独立运行**：不依赖 Python 解释器
- ⚠️ **镜像较大**：包含完整的运行时环境
- ⚠️ **构建较慢**：打包过程需要更多时间

### 使用方法
```bash
# 使用 PyInstaller 打包版本
docker build -f Dockerfile.secure -t rule-bot:secure .
```

### 保护效果
- 源码完全不可见
- 生成单个可执行文件
- 使用 UPX 压缩进一步保护

## 当前默认方案

当前 `Dockerfile` 使用字节码编译方案，在构建过程中：
1. 复制源码到镜像
2. 使用 `python -m compileall` 编译为字节码
3. 删除所有 `.py` 源码文件
4. 只保留 `.pyc` 字节码文件

## 安全建议

### 生产环境
- 推荐使用 **PyInstaller 打包方案**
- 提供最高级别的源码保护
- 适合商业应用和敏感项目

### 开发环境
- 可以使用 **字节码编译方案**
- 平衡了安全性和便利性
- 便于调试和问题排查

## 注意事项

1. **字节码反编译**：`.pyc` 文件可以被反编译工具还原
2. **动态分析**：运行时仍可能通过调试工具分析
3. **法律保护**：技术保护配合法律保护更有效
4. **定期更新**：建议定期更新保护方案

## 文件说明

- `Dockerfile`：当前使用的字节码编译方案
- `Dockerfile.bytecode`：字节码编译方案（与当前相同）
- `Dockerfile.secure`：PyInstaller 打包方案
- `rule-bot.spec`：PyInstaller 配置文件
- `start.sh`：PyInstaller 版本启动脚本
- `start.sh.bytecode`：字节码版本启动脚本

## 选择建议

- **一般用户**：使用当前默认方案（字节码编译）
- **商业用户**：使用 PyInstaller 打包方案
- **开发调试**：使用原始源码版本 